import{K as e,G as t,r as a,O as s,_ as i,q as r,N as n,j as l,Q as o,z as c,F as d,a3 as u,T as p,i as m,a4 as h,a5 as _,a6 as v,a7 as f,f as g,a8 as x,Z as b,h as j,k as N,a9 as y,aa as I,ab as w,ac as C,W as S,X as $,ad as k,a1 as O,ae as T,af as E,ag as F}from"./index-Z2btMU3L.js";import{A as P}from"./AddCustomer-BHB4YhFz.js";import{L as R,B as q,F as A,I as V,S as B,b as M}from"./TextField-CdfmgsOV.js";import{b as D}from"./Modal-Dw4KAW9k.js";import"./TextFieldElement-BjuRJ2TA.js";import"./Typography-C9ansQFg.js";const L=e("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),G=e("MuiListItemIcon",["root","alignItemsFlexStart"]),z=e("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function H(e){return t("MuiMenuItem",e)}const J=e("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),U=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],K=o(q,{shouldForwardProp:e=>u(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.dense&&t.dense,a.divider&&t.divider,!a.disableGutters&&t.gutters]}})((({theme:e,ownerState:t})=>r({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${J.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:p.alpha(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${J.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:p.alpha(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${J.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:p.alpha(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:p.alpha(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${J.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${J.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${L.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${L.inset}`]:{marginLeft:52},[`& .${z.root}`]:{marginTop:0,marginBottom:0},[`& .${z.inset}`]:{paddingLeft:36},[`& .${G.root}`]:{minWidth:36}},!t.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},t.dense&&r({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${G.root} svg`]:{fontSize:"1.25rem"}})))),W=a.forwardRef((function(e,t){const o=s({props:e,name:"MuiMenuItem"}),{autoFocus:u=!1,component:p="li",dense:m=!1,divider:h=!1,disableGutters:_=!1,focusVisibleClassName:v,role:f="menuitem",tabIndex:g,className:x}=o,b=i(o,U),j=a.useContext(R),N=a.useMemo((()=>({dense:m||j.dense||!1,disableGutters:_})),[j.dense,m,_]),y=a.useRef(null);D((()=>{u&&y.current&&y.current.focus()}),[u]);const I=r({},o,{dense:N.dense,divider:h,disableGutters:_}),w=(e=>{const{disabled:t,dense:a,divider:s,disableGutters:i,selected:n,classes:l}=e,o=d({root:["root",a&&"dense",t&&"disabled",!i&&"gutters",s&&"divider",n&&"selected"]},H,l);return r({},l,o)})(o),C=n(y,t);let S;return o.disabled||(S=void 0!==g?g:-1),l.jsx(R.Provider,{value:N,children:l.jsx(K,r({ref:C,role:f,tabIndex:S,component:p,focusVisibleClassName:c(w.focusVisible,v),className:c(w.root,x)},b,{ownerState:I,classes:w}))})})),Q=({product:e,infoFree:t=!1})=>{var a;const s=m();return l.jsx(l.Fragment,{children:l.jsxs("div",{className:"product_item_container",children:[l.jsx("div",{className:"product_img_item_container",children:l.jsx("img",{className:"product_img_item",src:null==(a=null==e?void 0:e.image)?void 0:a.url,alt:"image"})}),l.jsxs("div",{className:"product_details_item_container",children:[l.jsx("p",{className:"product_details_item_title",children:null==e?void 0:e.productName}),l.jsxs("p",{className:"product_details_item",children:["Stock: ",l.jsxs("span",{className:"span_item",children:[`${null==e?void 0:e.stock} Pares`," "]})]}),l.jsxs("p",{className:"product_details_item",children:["Talla: ",l.jsxs("span",{className:"span_item",children:[null==e?void 0:e.size," "]})]}),l.jsxs("p",{className:"product_details_item",children:["Subtotal Item: ",l.jsx("span",{className:"span_item",children:t?l.jsx("span",{className:"free_product_span",children:"Gratis"}):l.jsx("span",{className:"span_item",children:`$${((null==e?void 0:e.quantity)*(null==e?void 0:e.priceUnit)).toFixed(2)}`})})]}),l.jsxs("p",{className:"product_details_item",children:[t&&l.jsxs("span",{children:["Cantidad: ",null==e?void 0:e.quantity]}),t&&l.jsx("i",{className:"bx bxs-trash trash_free",onClick:()=>{s(h({productId:e.productId}))}})]}),!t&&l.jsxs("div",{className:"product_details_handle",children:[l.jsx("i",{className:"bx bx-minus product_cart_button_item_minus",onClick:()=>{s(_({productId:e.productId}))}}),l.jsxs("span",{className:"product_cart_text_pair_info",children:[null==e?void 0:e.quantity," Pares"]}),l.jsx("i",{className:"bx bx-plus product_cart_button_item_plus",onClick:()=>{s(v({productId:e.productId}))}}),l.jsx("i",{className:"bx bxs-trash",onClick:()=>{s(f({productId:e.productId}))}})]})]})]})})};Q.propTypes={product:g.shape({productId:g.oneOfType([g.string,g.number]).isRequired,productName:g.string.isRequired,image:g.shape({url:g.string}),stock:g.number.isRequired,quantity:g.number.isRequired,priceUnit:g.number.isRequired,size:g.string.isRequired}).isRequired,infoFree:g.bool};const X={VITE_API_URL_PROD:"https://www.everchic.ec/api/v1",VITE_RECAPTCHA_KEY_SITE_PROD:"6LdQNwgrAAAAAIXK5xQEXUrcYWpCnNaZJ1si9Pit"},Y=()=>{const{VITE_API_URL_PROD:e,VITE_RECAPTCHA_KEY_SITE_PROD:t}=X,s=e,{control:i,register:r,setValue:n,reset:o,clearErrors:c,formState:{errors:d},handleSubmit:u,watch:p,trigger:h}=x({mode:"onBlur"}),_=b((e=>{var t;return null==(t=e.user)?void 0:t.data})),v=b((e=>{var t;return null==(t=e.user)?void 0:t.token})),f=b((e=>"lightTheme"==e.theme?"light":"dark")),g=m(),R=j(),[q,D]=a.useState((()=>!(null==_?void 0:_.isVerify))),[L,G]=a.useState(!1),[z,H]=a.useState(),[J,U]=a.useState(null),[K,Y]=a.useState(!1),[Z,ee]=a.useState(!1),[te,ae]=a.useState([]);a.useEffect((()=>{if(!Z)try{window.grecaptcha.render("g-recaptcha",{sitekey:t,callback:e=>{U(e)},theme:f,"expired-callback":()=>{U(null)},"error-callback":()=>{U(null)},tabindex:0}),ee(!0)}catch(e){}}),[f,Z]);const se=b((e=>e.cart.storedCart)),ie=b((e=>e.cart.storedCartFree)),re=se.reduce(((e,t)=>e+t.quantity),0),ne=se.length>0?Number(se[0].priceUnit):0,le=b((e=>e.cart.quantityProductsFree)),oe=b((e=>e.cart.stateShippingCart)),ce=ie?ie.reduce(((e,t)=>e+t.quantity),0):0;a.useEffect((()=>{de()}),[]);const de=()=>{N.get(`${s}/shipping`).then((e=>{ae(e.data);const t=localStorage.getItem("selectedShippingOption"),a=t?parseInt(t):null;a&&(H(a),n("shippingId",a))})).catch((e=>{}))},ue={value:!0},pe=se.reduce(((e,t)=>e.plus(new y(t.weight).times(t.quantity))),new y(0)),me=ie.reduce(((e,t)=>e.plus(new y(t.weight).times(t.quantity))),new y(0)),he=pe.plus(me).toDecimalPlaces(2).toNumber(),_e=a.useCallback((e=>{const t=null==te?void 0:te.find((t=>t.id===e)),a=new y((null==t?void 0:t.shipping_value)||0),s=new y((null==t?void 0:t.extra_weight_cost)||0),i=new y((null==t?void 0:t.min_weight)||0),r=localStorage.getItem("selectedShippingOption"),n=r?parseInt(r):null;if(0!==se.length&&n){if(n)if(new y(he).lessThanOrEqualTo(i))g(I(a.toFixed(2)));else{const e=new y(he).minus(i),t=a.plus(e.times(s));g(I(t.toFixed(2)))}}else g(I(0))}),[se,g,te,he]);a.useEffect((()=>{se.length>0&&z&&he>0?_e(z):g(I(0))}),[se,_e,g,z,he]),a.useEffect((()=>{_&&(n("dni",null==_?void 0:_.dni),n("firstName",null==_?void 0:_.firstName),n("lastName",null==_?void 0:_.lastName),n("phone_first",null==_?void 0:_.phone_first),n("phone_second",null==_?void 0:_.phone_second),n("city",null==_?void 0:_.city),n("address",null==_?void 0:_.address),n("email",null==_?void 0:_.email))}),[_,n]);const ve=new y(re).times(ne).plus(oe||0).toDecimalPlaces(2),fe=ve.toNumber();a.useEffect((()=>{const e=p((e=>{const t={};if(e.dni!==(null==_?void 0:_.dni)&&(t.dni=e.dni),e.firstName!==(null==_?void 0:_.firstName)&&(t.firstName=e.firstName),e.lastName!==(null==_?void 0:_.lastName)&&(t.lastName=e.lastName),e.phone_first!==(null==_?void 0:_.phone_first)&&(t.phone_first=e.phone_first),e.phone_second!==(null==_?void 0:_.phone_second)&&(t.phone_second=e.phone_second),e.email!==(null==_?void 0:_.email)&&(t.email=e.email),e.city!==(null==_?void 0:_.city)&&(t.city=e.city),e.address!==(null==_?void 0:_.address)&&(t.address=e.address),Object.keys(t).length>0){const e={token:v,user:{..._,...t}};g(w(e))}}));return()=>e.unsubscribe()}),[p,_,g]);const ge=async e=>{var t,a,i,r,n,l,c,u,p,m,h,f,x;G(!0);const b={cart:se,cartFree:ie,captchaToken:J,token:v,userCartData:e,total:fe,shippingId:z,weight:he,userId:_.id};try{if(Object.keys(d).length>0)return void O.fire({position:"center",icon:"info",title:"Debes completar la informaciÃ³n de usuario",showConfirmButton:!0}).then((()=>{G(!1),be()}));await N.post(`${s}/orders/create_order`,b),O.fire({position:"center",icon:"success",text:"Orden enviada con Ã©xito ðŸŽ‰. "+((null==_?void 0:_.isVerify)?"":"No olvides verificar tu cuenta !!"),showConfirmButton:!0}).then((()=>{(null==_?void 0:_.isVerify)||o({password:"",repeat_password:""}),g(T()),R("/"),localStorage.removeItem("everchic_cart_free"),localStorage.removeItem("everchic_cart")}))}catch(j){let s;be();const d=null==(a=null==(t=j.response)?void 0:t.data)?void 0:a.message;if(d)return void O.fire({position:"center",icon:"warning",title:"Â¡Aviso!",text:d,showConfirmButton:!0,confirmButtonText:d.includes("debes verificar tu cuenta al correo")?"Reenviar correo":"Aceptar",showCancelButton:d.includes("debes verificar tu cuenta al correo"),cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&d.includes("debes verificar tu cuenta al correo")&&(xe(e.email),g(w({token:null,user:{}})),localStorage.removeItem("user"),o({password:"",repeat_password:""}))}));if((null==(n=null==(r=null==(i=j.response)?void 0:i.data)?void 0:r.result)?void 0:n.failOperation)&&O.fire({position:"center",icon:"warning",title:"Hubo un error la procesar la solicitud",text:d,showConfirmButton:!0}),null==(p=null==(u=null==(c=null==(l=j.response)?void 0:l.data)?void 0:c.result)?void 0:u.cartJoinFiltered)||p.forEach((e=>{s=`${e.title} (${e.description}): Stock actual: ${e.stock} Pares\n`})),(null==(x=null==(f=null==(h=null==(m=j.response)?void 0:m.data)?void 0:h.result)?void 0:f.cartJoinFiltered)?void 0:x.length)>0){O.fire({position:"center",icon:"info",title:"Producto con stock agotado",text:s,showConfirmButton:!0});let e=se.map((e=>{var t,a,s,i;const r=null==(i=null==(s=null==(a=null==(t=j.response)?void 0:t.data)?void 0:a.result)?void 0:s.cartJoinFiltered)?void 0:i.find((t=>t.productId===e.productId));return r?{...e,quantity:r.stock,stock:r.stock}:e})).filter((e=>e.quantity>0));localStorage.setItem("everchic_cart_free",JSON.stringify([])),g(E([])),g(F(0)),localStorage.setItem("everchic_cart",JSON.stringify(e)),g(E(e))}}finally{G(!1)}},xe=async e=>{G(!0);try{const t=`${s}/users/resend_email`;"Se ha enviado un correo de verificaciÃ³n"==(await N.post(t,{email:e})).data.message&&(O.fire({icon:"success",title:"Correo electrÃ³nico enviado",text:"Revisa tu correo electrÃ³nico para activar tu cuenta"}),G(!1))}catch(t){t&&(O.fire({icon:"error",title:"Error",text:"Opps.. algo salio mal.. !!"}),G(!1))}},be=()=>{window.grecaptcha&&(window.grecaptcha.reset(),U(null))};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"cart_container",children:[l.jsxs("div",{className:"cart_promo_container",children:[l.jsx("h4",{className:"cart_product_title",children:"Mi carrito"}),l.jsx("p",{className:"cart_product_offer",children:"[3 Pares $13] - [6 Pares $20] - [12 Pares $38] - [60 Pares $180]"})]}),l.jsxs("div",{className:"cart_product_container",children:[l.jsxs("div",{className:"cart_product_left_container",children:[l.jsx("div",{className:"cart_products_cart_buy",children:l.jsx("div",{className:"cart_items_container",children:(null==se?void 0:se.length)>0?se.map((e=>e?l.jsx(Q,{product:e},e.productId):null)):l.jsx("div",{className:"cart_product_msj_alert",children:l.jsx("p",{className:"cart_product_messaje",children:"Â¡No ha agregado productos ðŸ§¦!"})})})}),le>0&&l.jsx("div",{className:"cart_products_free",children:le>0?l.jsxs("div",{className:"cart_free_container",children:[l.jsxs("div",{className:"cart_alert_button_free",children:[le>0&&le>ce&&l.jsx("button",{className:"cart_product_free_alert button",onClick:()=>{le>0&&ce<le?(g(k(!0)),R("/productos")):g(k(!1))},children:"Agregar"}),l.jsxs("h5",{className:"cart_info_unit_free",children:["Productos gratis: ",le]})]}),l.jsx("div",{className:"cart_elemments_free_container",children:(null==ie?void 0:ie.length)>0?ie.map((e=>l.jsx(Q,{product:e,infoFree:ue},e.productId))):l.jsx("div",{className:"cart_product_msj_alert",children:l.jsx("p",{className:"cart_product_messaje",children:"Â¡No olvides agregar tus productos gratis ðŸ§¦!"})})})]}):""})]}),l.jsx("div",{className:"cart_details_info_buy_container",children:l.jsxs("form",{onSubmit:u(ge),children:[l.jsx("div",{className:"add_customer_info_user_container",children:l.jsx(P,{register:r,setValue:n,setIsEditable:D,isEditable:q,reset:o,clearErrors:c,watch:p,errors:d,trigger:h,handleSubmit:u,onSubmitForm:ge})}),l.jsxs("div",{className:"cart_detail_shipping_form",method:"post",id:"shipping_form",children:[l.jsx("div",{className:"cart_detail_method_shipping_container",children:l.jsxs(A,{fullWidth:!0,children:[l.jsx(V,{id:"shipping-select-label",children:"Seleccionar mÃ©todo de envÃ­o"}),l.jsx(C,{name:"shippingId",control:i,defaultValue:"",rules:{required:"Este campo es obligatorio"},render:({field:e})=>l.jsx(B,{...e,labelId:"shipping-select-label",id:"shipping-select",label:"Seleccione mÃ©todo de envÃ­o",onChange:t=>{var a;e.onChange(t),H((a=t).target.value),localStorage.setItem("selectedShippingOption",a.target.value)},children:te.map((e=>l.jsx(W,{value:e.id,children:e.shipping_name},e.id)))})}),d.shippingId&&l.jsx(M,{error:!0,children:d.shippingId.message})]})}),l.jsxs("div",{className:"cart_detail_buy_container",children:[l.jsx("div",{className:"cart_detail_buy_title_container",children:l.jsx("h4",{className:"cart_detail_title",children:"Resumen de Compra"})}),l.jsxs("ul",{className:"cart_info_message_container",children:[l.jsxs("li",{className:"cart_info_message",children:[re," pares",ce>0&&` y ${ce} de obsequio`,". ðŸ§¦"]}),l.jsxs("li",{className:"cart_info_weight",children:["Peso: ",he," Kg"]})]}),l.jsxs("div",{className:"cart_info_buy_container",children:[l.jsx("div",{className:"cart_info_title_container",children:l.jsxs("ul",{children:[l.jsx("li",{className:"cart_info_title",children:"Subtotal"}),l.jsx("li",{className:"cart_info_title",children:"Descuento"}),l.jsx("li",{className:"cart_info_title",children:"IVA 15%"}),l.jsx("li",{className:"cart_info_title",children:"EnvÃ­o"})]})}),l.jsx("div",{className:"cart_info_title_container_$",children:l.jsxs("ul",{children:[l.jsxs("li",{className:"cart_info_value",children:["$ ",(re*ne).toFixed(2)]}),l.jsx("li",{className:"cart_info_value",children:"$ 0.00"}),l.jsx("li",{className:"cart_info_value",children:"$ 0.00"}),l.jsxs("li",{className:"cart_info_value",children:["$ ",oe]})]})})]})]}),l.jsx("div",{className:"cart_info_total_container",children:l.jsx("ul",{className:"cart_info_total",children:l.jsxs("li",{className:"cart_info_total_text",children:["Total a pagar: $ ",ve.toFixed(2)]})})}),l.jsxs("div",{className:"add_customer_buttons_container",children:[l.jsx("div",{id:"g-recaptcha",className:"g-recaptcha",style:{padding:" 20px  0px"},"data-sitekey":t,"data-theme":f,role:"compra","aria-label":"VerificaciÃ³n de seguridad reCAPTCHA"}),l.jsx("button",{type:"submit",className:"add_customer_button button",children:"Enviar al vendedor"})]})]})]})})]})]}),l.jsx(S,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:L,children:l.jsx($,{color:"inherit"})})]})};export{Y as default};
