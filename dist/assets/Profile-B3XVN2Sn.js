import{j as e,f as a,r as s,k as r,Z as i,i as t,a8 as l,m as o,W as n,X as d,a1 as c,ap as m}from"./index-Z2btMU3L.js";import{g as u}from"./getConfigAuth-BUruOnyX.js";import{T as p,B as _}from"./TextFieldElement-BjuRJ2TA.js";import{B as h}from"./Modal-Dw4KAW9k.js";import"./TextField-CdfmgsOV.js";const v=({product:a,productData:s})=>{var r;if(!a||!s)return null;const{price_unit:i,quantity:t}=a,{productImgs:l,title:o,size:n}=s,d=parseFloat(i*t).toFixed(2);return e.jsxs("div",{className:"order_item_product_container",children:[e.jsx("div",{className:"order_item_product_image_container",children:e.jsx("img",{src:null==(r=l[0])?void 0:r.url_small,alt:o,className:"order_item_product_image"})}),e.jsx("div",{className:"order_item_product_body",children:e.jsxs("ul",{className:"order_item_product_ul",children:[e.jsx("li",{className:"order_item_product_title",children:o}),e.jsxs("li",{className:"order_item_product_quantity",children:["Cantidad: ",t]}),e.jsxs("li",{className:"order_item_product_size",children:["Talla: ",n.size]}),e.jsxs("li",{className:"order_item_product_subtotal",children:["Subtotal: $",d]})]})})]})};v.propTypes={product:a.shape({price_unit:a.number.isRequired,quantity:a.number.isRequired}).isRequired,productData:a.shape({productImgs:a.arrayOf(a.shape({url_small:a.string})).isRequired,title:a.string,size:a.shape({size:a.string.isRequired}).isRequired}).isRequired};const x={VITE_API_URL_PROD:"https://www.everchic.ec/api/v1"},g=({order:a})=>{const{VITE_API_URL_PROD:i}=x,t=i,[l,o]=s.useState([]),[n,d]=s.useState([]);return s.useEffect((()=>{(async()=>{try{const e=(await r.get(`${t}/orders_items/order/${a.id}`,u())).data;o(e);const s=e.map((e=>r.get(`${t}/products/${e.productId}`,u()))),i=await Promise.all(s);d(i.map((e=>e.data)))}catch(e){}})()}),[a.id,t]),e.jsx(e.Fragment,{children:l.map(((a,s)=>e.jsx("div",{className:"order_product_container",children:e.jsx(v,{product:a,productData:n[s]})},a.id)))})};g.propTypes={order:a.shape({id:a.number.isRequired}).isRequired};const f={VITE_API_URL_PROD:"https://www.everchic.ec/api/v1"},j=()=>{const{VITE_API_URL_PROD:a}=f,t=a,[l,o]=s.useState([]),[n,d]=s.useState([]),[c,m]=s.useState(!1),[p,_]=s.useState(null),h=i((e=>{var a;return null==(a=e.user.data)?void 0:a.id}));s.useEffect((()=>{if(h){(async()=>{var e,a;try{const e=(await r.get(`${t}/orders/${h}`,u())).data;o(e),d(e.map((()=>!1))),_(null)}catch(s){_((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Error en la petición de ordenes")}})()}}),[h,t]);const v=e=>{d((a=>{const s=[...a];return s[e]=!s[e],s})),m(!c)},x=e=>{const a=new Date(e);return`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()}`};return p?e.jsxs("div",{children:["Error: ",p]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profile_title_shipping_container",children:e.jsx("h4",{className:"profile_title_shipping",children:"Mis pedidos"})}),l.map(((a,s)=>e.jsxs("div",{className:`orders_main_container ${n[s]&&"orders_main_container_hidden"}`,children:[e.jsxs("div",{className:"order_main_header",children:[e.jsxs("span",{className:"order_main_date",children:["Fecha: ",x(a.updatedAt)," - ",(null==a?void 0:a.orderStatus.order_status.charAt(0).toUpperCase())+(null==a?void 0:a.orderStatus.order_status.slice(1))," "]}),e.jsxs("div",{className:"orders_main_right_elements_container",children:[e.jsxs("span",{className:"order_main_total",children:["Total: $",a.total," Inc. envío."]}),e.jsx("i",{className:"bx bx-chevron-down chevron_hidden_down "+(n[s]?"chevron_visible":""),onClick:()=>v(s)}),e.jsx("i",{className:"bx bx-chevron-up chevron_hidden_up "+(n[s]?"chevron_hidden":""),onClick:()=>v(s)})]})]}),l.length>0&&e.jsx(g,{order:a})]},a.id)))]})},b={VITE_API_URL_PROD:"https://www.everchic.ec/api/v1"},N=()=>{const{VITE_API_URL_PROD:a}=b,v=a,x=t(),[g,f]=s.useState(!1),[N,q]=s.useState(!1),[E,y]=s.useState(null),{register:$,setValue:R,handleSubmit:w,formState:{errors:S}}=l(),A=i((e=>e.user.data));s.useEffect((()=>{A&&(R("dni",null==A?void 0:A.dni),R("firstName",null==A?void 0:A.firstName),R("lastName",null==A?void 0:A.lastName),R("phone_first",null==A?void 0:A.phone_first),R("phone_second",null==A?void 0:A.phone_second),R("city",null==A?void 0:A.city),R("address",null==A?void 0:A.address),R("email",null==A?void 0:A.email))}),[A,R]);return e.jsxs(o.div,{className:"product_filter_elements_container",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[e.jsxs("div",{className:"profile_container",children:[e.jsxs("div",{className:"profile_title_container",children:[e.jsx("div",{className:"profile_avatar_container",children:e.jsx("img",{className:"profile_avatar",src:`https://api.dicebear.com/8.x/pixel-art/svg?seed=${null==A?void 0:A.firstName}`,alt:""})}),e.jsxs("div",{className:"profile_avatar_info_container",children:[e.jsx("h3",{className:"profile_title",children:(null==A?void 0:A.firstName)+" "+(null==A?void 0:A.lastName)}),e.jsx("p",{className:"profile_subtitle",children:null==A?void 0:A.city})]})]}),e.jsxs("div",{className:"profile_data_customer_container",children:[e.jsx("div",{className:"profile_container_orders",children:e.jsx(j,{})}),e.jsxs("form",{className:"profile_form",onSubmit:w((async e=>{if(E){f(!0);try{const a=await r.put(`${v}/users/${null==A?void 0:A.id}/update_user`,{user:e,captchaToken:E},u());x(m({user:a.data})),c.fire({position:"center",icon:"success",text:"Actualización completada",showConfirmButton:!1,timer:1500}).then((()=>{q(!1)}))}catch(a){q(!0),c.fire({position:"center",icon:"error",text:`Error: ${a.response.data.message}`,showConfirmButton:!0})}finally{f(!1),y(null)}}else c.fire({position:"center",icon:"error",text:"Por favor, completa el captcha.",showConfirmButton:!0})})),children:[e.jsx("h4",{className:"profile_title_shipping",children:"Datos de envío"}),e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(p,{name:"dni",label:"Cédula ó RUC:",errors:S,disabled:!N,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},minLength:{value:10,message:"Mínimo 10 caracteres"},maxLength:{value:13,message:"Máximo 13 caracteres"},pattern:{value:/^[0-9]{10,13}$/,message:"La cédula/RUC solo debe contener números"}}}),e.jsx(p,{name:"firstName",label:"Nombres:",errors:S,disabled:!N,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:{value:25,message:"Máximo 25 caracteres"},pattern:{value:/^[a-zA-Z\s]+$/,message:"El nombre solo debe contener letras"}}}),e.jsx(p,{name:"lastName",label:"Apellidos:",errors:S,disabled:!N,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:{value:25,message:"Máximo 25 caracteres"},pattern:{value:/^[a-zA-Z\s]+$/,message:"El apellido solo debe contener letras"}}}),e.jsx(p,{name:"phone_first",label:"Teléfono:",errors:S,disabled:!N,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:{value:10,message:"Máximo 10 caracteres"},pattern:{value:/^[0-9]{10}$/,message:"El teléfono debe ser un número de 10 dígitos"}}}),e.jsx(p,{name:"phone_second",label:"Teléfono adicional:",errors:S,disabled:!N,register:$,validation:{required:{value:!1,message:"Este campo es opcional"},maxLength:{value:10,message:"Máximo 10 caracteres"},pattern:{value:/^[0-9]{10}$/,message:"El teléfono adicional debe ser un número de 10 dígitos"}}}),e.jsx(p,{name:"city",label:"Ciudad:",errors:S,disabled:!N,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:{value:30,message:"Máximo 30 caracteres"},pattern:{value:/^[a-zA-Z]+$/,message:"La ciudad solo debe contener letras"}}}),e.jsx(p,{name:"email",label:"email:",errors:S,disabled:!0,value:(null==A?void 0:A.email)||"",register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:{value:30,message:"Máximo 30 caracteres"},pattern:{value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/,message:"Debe ser un email válido"}}}),e.jsx(p,{name:"address",label:"Dirección:",errors:S,disabled:!N,multiline:!0,register:$,validation:{required:{value:!0,message:"Este campo es requerido"},maxLength:200,pattern:{value:/^[a-zA-Z0-9\s]+$/,message:"La dirección solo debe contener letras, números y espacios"}}})]}),e.jsxs("div",{className:"profile_buttons_container",children:[N?e.jsx(_,{className:"profile_button",onClick:()=>q(!1),children:"Cancelar"}):e.jsx(_,{className:"profile_button",onClick:()=>q(!0),children:"Editar"}),N&&e.jsx(_,{className:"profile_button",type:"submit",children:"Guardar"})]})]})]})]}),e.jsx(n,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:g,children:e.jsx(d,{color:"inherit"})})]})};export{N as default};
