import{h as e,j as t,P as s,u as a,f as i,r,F as l,I as n,z as c,M as o,E as d,B as u,C as m}from"./vendor-Dv1Rd94t.js";import{f as p,m as _,p as h,g as v,u as f,a as x,D as g,h as j,s as N,C as b,i as I,e as w,j as y,k as S,l as C}from"./index-BxeSiO34.js";import{A as k}from"./AddCustomer-CTrq6VW3.js";import"./ui-C9JqUebO.js";import"jquery";import"./TextFieldElement-DDRUCHg0.js";const E=({product:s,infoFree:a=!1})=>{var i;const r=e();return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"product_item_container",children:[t.jsx("div",{className:"product_img_item_container",children:t.jsx("img",{className:"product_img_item",src:null==(i=null==s?void 0:s.image)?void 0:i.url,alt:"image"})}),t.jsxs("div",{className:"product_details_item_container",children:[t.jsx("p",{className:"product_details_item_title",children:null==s?void 0:s.productName}),t.jsxs("p",{className:"product_details_item",children:["Stock: ",t.jsxs("span",{className:"span_item",children:[`${null==s?void 0:s.stock} Pares`," "]})]}),t.jsxs("p",{className:"product_details_item",children:["Talla: ",t.jsxs("span",{className:"span_item",children:[null==s?void 0:s.size," "]})]}),t.jsxs("p",{className:"product_details_item",children:["Subtotal Item: ",t.jsx("span",{className:"span_item",children:a?t.jsx("span",{className:"free_product_span",children:"Gratis"}):t.jsx("span",{className:"span_item",children:`$${((null==s?void 0:s.quantity)*(null==s?void 0:s.priceUnit)).toFixed(2)}`})})]}),t.jsxs("p",{className:"product_details_item",children:[a&&t.jsxs("span",{children:["Cantidad: ",null==s?void 0:s.quantity]}),a&&t.jsx("i",{className:"bx bxs-trash trash_free",onClick:()=>{r(p({productId:s.productId}))}})]}),!a&&t.jsxs("div",{className:"product_details_handle",children:[t.jsx("i",{className:"bx bx-minus product_cart_button_item_minus",onClick:()=>{r(_({productId:s.productId}))}}),t.jsxs("span",{className:"product_cart_text_pair_info",children:[null==s?void 0:s.quantity," Pares"]}),t.jsx("i",{className:"bx bx-plus product_cart_button_item_plus",onClick:()=>{r(h({productId:s.productId}))}}),t.jsx("i",{className:"bx bxs-trash",onClick:()=>{r(v({productId:s.productId}))}})]})]})]})})};E.propTypes={product:s.shape({productId:s.oneOfType([s.string,s.number]).isRequired,productName:s.string.isRequired,image:s.shape({url:s.string}),stock:s.number.isRequired,quantity:s.number.isRequired,priceUnit:s.number.isRequired,size:s.string.isRequired}).isRequired,infoFree:s.bool};const P={VITE_API_URL_PROD:"https://www.everchic.ec/api/v1",VITE_RECAPTCHA_KEY_SITE_PROD:"6LdQNwgrAAAAAIXK5xQEXUrcYWpCnNaZJ1si9Pit"},q=()=>{const{VITE_API_URL_PROD:s,VITE_RECAPTCHA_KEY_SITE_PROD:p}=P,_=s,{control:h,register:v,setValue:q,reset:T,clearErrors:$,formState:{errors:A},handleSubmit:F,watch:R,trigger:O}=f({mode:"onBlur"}),V=a((e=>{var t;return null==(t=e.user)?void 0:t.data})),B=a((e=>{var t;return null==(t=e.user)?void 0:t.token})),D=a((e=>"lightTheme"==e.theme?"light":"dark")),J=e(),U=i(),[z,H]=r.useState((()=>!(null==V?void 0:V.isVerify))),[K,L]=r.useState(!1),[Y,M]=r.useState(),[Q,W]=r.useState(null),[X,G]=r.useState(!1),[Z,ee]=r.useState(!1),[te,se]=r.useState([]);r.useEffect((()=>{if(!Z)try{window.grecaptcha.render("g-recaptcha",{sitekey:p,callback:e=>{W(e)},theme:D,"expired-callback":()=>{W(null)},"error-callback":()=>{W(null)},tabindex:0}),ee(!0)}catch(e){}}),[D,Z]);const ae=a((e=>e.cart.storedCart)),ie=a((e=>e.cart.storedCartFree)),re=ae.reduce(((e,t)=>e+t.quantity),0),le=ae.length>0?Number(ae[0].priceUnit):0,ne=a((e=>e.cart.quantityProductsFree)),ce=a((e=>e.cart.stateShippingCart)),oe=ie?ie.reduce(((e,t)=>e+t.quantity),0):0;r.useEffect((()=>{de()}),[]);const de=()=>{x.get(`${_}/shipping`).then((e=>{se(e.data);const t=localStorage.getItem("selectedShippingOption"),s=t?parseInt(t):null;s&&(M(s),q("shippingId",s))})).catch((e=>{}))},ue={value:!0},me=ae.reduce(((e,t)=>e.plus(new g(t.weight).times(t.quantity))),new g(0)),pe=ie.reduce(((e,t)=>e.plus(new g(t.weight).times(t.quantity))),new g(0)),_e=me.plus(pe).toDecimalPlaces(2).toNumber(),he=r.useCallback((e=>{const t=null==te?void 0:te.find((t=>t.id===e)),s=new g((null==t?void 0:t.shipping_value)||0),a=new g((null==t?void 0:t.extra_weight_cost)||0),i=new g((null==t?void 0:t.min_weight)||0),r=localStorage.getItem("selectedShippingOption"),l=r?parseInt(r):null;if(0!==ae.length&&l){if(l)if(new g(_e).lessThanOrEqualTo(i))J(j(s.toFixed(2)));else{const e=new g(_e).minus(i),t=s.plus(e.times(a));J(j(t.toFixed(2)))}}else J(j(0))}),[ae,J,te,_e]);r.useEffect((()=>{ae.length>0&&Y&&_e>0?he(Y):J(j(0))}),[ae,he,J,Y,_e]),r.useEffect((()=>{V&&(q("dni",null==V?void 0:V.dni),q("firstName",null==V?void 0:V.firstName),q("lastName",null==V?void 0:V.lastName),q("phone_first",null==V?void 0:V.phone_first),q("phone_second",null==V?void 0:V.phone_second),q("city",null==V?void 0:V.city),q("address",null==V?void 0:V.address),q("email",null==V?void 0:V.email))}),[V,q]);const ve=new g(re).times(le).plus(ce||0).toDecimalPlaces(2),fe=ve.toNumber();r.useEffect((()=>{const e=R((e=>{const t={};if(e.dni!==(null==V?void 0:V.dni)&&(t.dni=e.dni),e.firstName!==(null==V?void 0:V.firstName)&&(t.firstName=e.firstName),e.lastName!==(null==V?void 0:V.lastName)&&(t.lastName=e.lastName),e.phone_first!==(null==V?void 0:V.phone_first)&&(t.phone_first=e.phone_first),e.phone_second!==(null==V?void 0:V.phone_second)&&(t.phone_second=e.phone_second),e.email!==(null==V?void 0:V.email)&&(t.email=e.email),e.city!==(null==V?void 0:V.city)&&(t.city=e.city),e.address!==(null==V?void 0:V.address)&&(t.address=e.address),Object.keys(t).length>0){const e={token:B,user:{...V,...t}};J(N(e))}}));return()=>e.unsubscribe()}),[R,V,J]);const xe=async e=>{var t,s,a,i,r,l,n,c,o,d,u,m,p;L(!0);const h={cart:ae,cartFree:ie,captchaToken:Q,token:B,userCartData:e,total:fe,shippingId:Y,weight:_e,userId:V.id};try{if(Object.keys(A).length>0)return void w.fire({position:"center",icon:"info",title:"Debes completar la información de usuario",showConfirmButton:!0}).then((()=>{L(!1),je()}));await x.post(`${_}/orders/create_order`,h),w.fire({position:"center",icon:"success",text:"Orden enviada con éxito 🎉. "+((null==V?void 0:V.isVerify)?"":"No olvides verificar tu cuenta !!"),showConfirmButton:!0}).then((()=>{(null==V?void 0:V.isVerify)||T({password:"",repeat_password:""}),J(y()),U("/"),localStorage.removeItem("everchic_cart_free"),localStorage.removeItem("everchic_cart")}))}catch(v){let _;je();const h=null==(s=null==(t=v.response)?void 0:t.data)?void 0:s.message;if(h)return void w.fire({position:"center",icon:"warning",title:"¡Aviso!",text:h,showConfirmButton:!0,confirmButtonText:h.includes("debes verificar tu cuenta al correo")?"Reenviar correo":"Aceptar",showCancelButton:h.includes("debes verificar tu cuenta al correo"),cancelButtonText:"Cancelar"}).then((t=>{t.isConfirmed&&h.includes("debes verificar tu cuenta al correo")&&(ge(e.email),J(N({token:null,user:{}})),localStorage.removeItem("user"),T({password:"",repeat_password:""}))}));if((null==(r=null==(i=null==(a=v.response)?void 0:a.data)?void 0:i.result)?void 0:r.failOperation)&&w.fire({position:"center",icon:"warning",title:"Hubo un error la procesar la solicitud",text:h,showConfirmButton:!0}),null==(o=null==(c=null==(n=null==(l=v.response)?void 0:l.data)?void 0:n.result)?void 0:c.cartJoinFiltered)||o.forEach((e=>{_=`${e.title} (${e.description}): Stock actual: ${e.stock} Pares\n`})),(null==(p=null==(m=null==(u=null==(d=v.response)?void 0:d.data)?void 0:u.result)?void 0:m.cartJoinFiltered)?void 0:p.length)>0){w.fire({position:"center",icon:"info",title:"Producto con stock agotado",text:_,showConfirmButton:!0});let e=ae.map((e=>{var t,s,a,i;const r=null==(i=null==(a=null==(s=null==(t=v.response)?void 0:t.data)?void 0:s.result)?void 0:a.cartJoinFiltered)?void 0:i.find((t=>t.productId===e.productId));return r?{...e,quantity:r.stock,stock:r.stock}:e})).filter((e=>e.quantity>0));localStorage.setItem("everchic_cart_free",JSON.stringify([])),J(S([])),J(C(0)),localStorage.setItem("everchic_cart",JSON.stringify(e)),J(S(e))}}finally{L(!1)}},ge=async e=>{L(!0);try{const t=`${_}/users/resend_email`;"Se ha enviado un correo de verificación"==(await x.post(t,{email:e})).data.message&&(w.fire({icon:"success",title:"Correo electrónico enviado",text:"Revisa tu correo electrónico para activar tu cuenta"}),L(!1))}catch(t){t&&(w.fire({icon:"error",title:"Error",text:"Opps.. algo salio mal.. !!"}),L(!1))}},je=()=>{window.grecaptcha&&(window.grecaptcha.reset(),W(null))};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"cart_container",children:[t.jsxs("div",{className:"cart_promo_container",children:[t.jsx("h4",{className:"cart_product_title",children:"Mi carrito"}),t.jsx("p",{className:"cart_product_offer",children:"[3 Pares $13] - [6 Pares $20] - [12 Pares $38] - [60 Pares $180]"})]}),t.jsxs("div",{className:"cart_product_container",children:[t.jsxs("div",{className:"cart_product_left_container",children:[t.jsx("div",{className:"cart_products_cart_buy",children:t.jsx("div",{className:"cart_items_container",children:(null==ae?void 0:ae.length)>0?ae.map((e=>e?t.jsx(E,{product:e},e.productId):null)):t.jsx("div",{className:"cart_product_msj_alert",children:t.jsx("p",{className:"cart_product_messaje",children:"¡No ha agregado productos 🧦!"})})})}),ne>0&&t.jsx("div",{className:"cart_products_free",children:ne>0?t.jsxs("div",{className:"cart_free_container",children:[t.jsxs("div",{className:"cart_alert_button_free",children:[ne>0&&ne>oe&&t.jsx("button",{className:"cart_product_free_alert button",onClick:()=>{ne>0&&oe<ne?(J(I(!0)),U("/productos")):J(I(!1))},children:"Agregar"}),t.jsxs("h5",{className:"cart_info_unit_free",children:["Productos gratis: ",ne]})]}),t.jsx("div",{className:"cart_elemments_free_container",children:(null==ie?void 0:ie.length)>0?ie.map((e=>t.jsx(E,{product:e,infoFree:ue},e.productId))):t.jsx("div",{className:"cart_product_msj_alert",children:t.jsx("p",{className:"cart_product_messaje",children:"¡No olvides agregar tus productos gratis 🧦!"})})})]}):""})]}),t.jsx("div",{className:"cart_details_info_buy_container",children:t.jsxs("form",{onSubmit:F(xe),children:[t.jsx("div",{className:"add_customer_info_user_container",children:t.jsx(k,{register:v,setValue:q,setIsEditable:H,isEditable:z,reset:T,clearErrors:$,watch:R,errors:A,trigger:O,handleSubmit:F,onSubmitForm:xe})}),t.jsxs("div",{className:"cart_detail_shipping_form",method:"post",id:"shipping_form",children:[t.jsx("div",{className:"cart_detail_method_shipping_container",children:t.jsxs(l,{fullWidth:!0,children:[t.jsx(n,{id:"shipping-select-label",children:"Seleccionar método de envío"}),t.jsx(b,{name:"shippingId",control:h,defaultValue:"",rules:{required:"Este campo es obligatorio"},render:({field:e})=>t.jsx(c,{...e,labelId:"shipping-select-label",id:"shipping-select",label:"Seleccione método de envío",onChange:t=>{var s;e.onChange(t),M((s=t).target.value),localStorage.setItem("selectedShippingOption",s.target.value)},children:te.map((e=>t.jsx(o,{value:e.id,children:e.shipping_name},e.id)))})}),A.shippingId&&t.jsx(d,{error:!0,children:A.shippingId.message})]})}),t.jsxs("div",{className:"cart_detail_buy_container",children:[t.jsx("div",{className:"cart_detail_buy_title_container",children:t.jsx("h4",{className:"cart_detail_title",children:"Resumen de Compra"})}),t.jsxs("ul",{className:"cart_info_message_container",children:[t.jsxs("li",{className:"cart_info_message",children:[re," pares",oe>0&&` y ${oe} de obsequio`,". 🧦"]}),t.jsxs("li",{className:"cart_info_weight",children:["Peso: ",_e," Kg"]})]}),t.jsxs("div",{className:"cart_info_buy_container",children:[t.jsx("div",{className:"cart_info_title_container",children:t.jsxs("ul",{children:[t.jsx("li",{className:"cart_info_title",children:"Subtotal"}),t.jsx("li",{className:"cart_info_title",children:"Descuento"}),t.jsx("li",{className:"cart_info_title",children:"IVA 15%"}),t.jsx("li",{className:"cart_info_title",children:"Envío"})]})}),t.jsx("div",{className:"cart_info_title_container_$",children:t.jsxs("ul",{children:[t.jsxs("li",{className:"cart_info_value",children:["$ ",(re*le).toFixed(2)]}),t.jsx("li",{className:"cart_info_value",children:"$ 0.00"}),t.jsx("li",{className:"cart_info_value",children:"$ 0.00"}),t.jsxs("li",{className:"cart_info_value",children:["$ ",ce]})]})})]})]}),t.jsx("div",{className:"cart_info_total_container",children:t.jsx("ul",{className:"cart_info_total",children:t.jsxs("li",{className:"cart_info_total_text",children:["Total a pagar: $ ",ve.toFixed(2)]})})}),t.jsxs("div",{className:"add_customer_buttons_container",children:[t.jsx("div",{id:"g-recaptcha",className:"g-recaptcha",style:{padding:" 20px  0px"},"data-sitekey":p,"data-theme":D,role:"compra","aria-label":"Verificación de seguridad reCAPTCHA"}),t.jsx("button",{type:"submit",className:"add_customer_button button",children:"Enviar al vendedor"})]})]})]})})]})]}),t.jsx(u,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:K,children:t.jsx(m,{color:"inherit"})})]})};export{q as default};
